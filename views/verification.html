<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>График поверки и аттестации СИ</title>
    
    <!-- Подключаем внешние библиотеки и стили -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Главные стили модуля (которые импортируют все остальные) -->
    <link rel="stylesheet" href="/css/verification/verification.css">
    
    <!-- Стили компонента Datepicker -->
    <link rel="stylesheet" href="/css/components/datepicker.css">
</head>
<body>
    <!-- Декоративные анимированные элементы фона -->
    <div class="floating-bg"></div>
    <div class="floating-bg"></div>
    <div class="floating-bg"></div>
    <div class="pulsating-dot"></div>
    <div class="pulsating-dot"></div>
    <div class="pulsating-dot"></div>

    <div class="container">
        <!-- Новая унифицированная шапка -->
        <header class="new-header">
            <div class="logo">
                <div class="logo-icon"><i class="fas fa-tools"></i></div>
                <div class="logo-text">
                    <h1>График поверки</h1>
                    <p>Поверка и аттестация оборудования</p>
                </div>
            </div>
            <div class="user-actions">
                <div class="user-profile">
                    <div class="user-avatar"><span>...</span></div>
                    <div class="user-info">
                        <span class="user-name">Загрузка...</span>
                        <span class="user-role">...</span>
                    </div>
                </div>
                <a href="/dashboard" title="Вернуться на дашборд" class="logout-button">
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
        </header>

        <!-- Панель управления (поиск, тип, кнопка) -->
        <div class="controls-panel">
            <div class="equipment-selector">
                <div class="equipment-label">Тип:</div>
                <div class="equipment-buttons">
                    <button class="equipment-btn active" data-type="si">Эталоны/СИ</button>
                    <button class="equipment-btn" data-type="vo">ВО</button>
                </div>
            </div>
            <div class="search-container">
                <div class="search-box">
                    <svg class="search-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/></svg>
                    <input type="text" class="search-input" id="verification-search-input" placeholder="Поиск по наименованию, зав. или инв. номеру...">
                    <button class="clear-search" title="Очистить поиск"><svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor"><path d="M14 1.41L12.59 0 7 5.59 1.41 0 0 1.41 5.59 7 0 12.59 1.41 14 7 8.41 12.59 14 14 12.59 8.41 7 14 1.41z"/></svg></button>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-primary" id="addEquipmentBtn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>Добавить оборудование</button>
            </div>
        </div>
        
        <div class="table-wrapper">
            <div class="table-container">
                <table id="siTable">
                    <thead>
                        <tr>
                            <th class="col-num">№ п/п</th>
                            <th class="col-name sortable" data-column="name">Наименование СИ</th>
                            <th class="col-type sortable" data-column="modification">Модификация (исполнение)</th>
                            <th class="col-reg">Рег. номер (ГРСИ)</th>
                            <th class="col-serial sortable" data-column="serialNumber">Зав. №</th>
                            <th class="col-inv sortable" data-column="inventoryNumber">Инв. №</th>
                            <th class="col-commission sortable" data-column="commissionDate">Ввод в экспл.</th>
                            <th class="col-year sortable" data-column="yearManufactured">Год выпуска</th>
                            <th class="col-verification sortable" data-column="lastVerificationDate">Дата поверки</th>
                            <th class="col-next-verification sortable" data-column="nextVerificationDate">Дата след.поверки</th>
                            <th class="col-city sortable" data-column="city">Город</th>
                            <th class="col-responsible sortable" data-column="responsible">Ответственный</th>
                            <th class="col-actions">Действия</th>
                        </tr>
                    </thead>
                    <tbody><!-- Динамическое содержимое --></tbody>
                </table>
                <table id="voTable" style="display: none;">
                    <thead>
                        <tr>
                            <th class="col-num">№ п/п</th>
                            <th class="col-vo-name sortable" data-column="name">Наименование</th>
                            <th class="col-vo-serial sortable" data-column="serialNumber">Зав. №</th>
                            <th class="col-vo-inv sortable" data-column="inventoryNumber">Инв. №</th>
                            <th class="col-vo-year sortable" data-column="yearManufactured">Год выпуска</th>
                            <th class="col-vo-verification sortable" data-column="lastVerificationDate">Дата аттестации</th>
                            <th class="col-vo-next-verification sortable" data-column="nextVerificationDate">Дата след.аттестации</th>
                            <th class="col-vo-city sortable" data-column="city">Город</th>
                            <th class="col-actions">Действия</th>
                        </tr>
                    </thead>
                    <tbody><!-- Динамическое содержимое --></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Модальное окно для добавления -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Добавление нового оборудования</div>
                <button class="modal-close" type="button">
                    <svg width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                        <line x1="1" y1="1" x2="13" y2="13"></line>
                        <line x1="13" y1="1" x2="1" y2="13"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="type-selection">
                    <div class="type-option" data-type="si"><svg class="type-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg><div class="type-name">Средство измерения</div><div class="type-description">Рабочие средства измерений</div></div>
                    <div class="type-option selected" data-type="etalon"><svg class="type-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg><div class="type-name">Эталон</div><div class="type-description">Образцовые средства измерений</div></div>
                    <div class="type-option" data-type="vo"><svg class="type-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg><div class="type-name">Вспом. оборудование</div><div class="type-description">Оборудование, не являющееся СИ</div></div>
                </div>
                
                <div id="add-si-fields">
                    <div class="form-section"><div class="form-section-title">Основная информация</div><div class="form-group"><label class="form-label">Наименование *</label><input type="text" class="form-input" id="addName"></div><div class="form-group"><label class="form-label">Модификация (исполнение) *</label><input type="text" class="form-input" id="addModification"></div>
                    <div class="form-group">
                        <label class="form-label" id="reg-number-label">Регистрационный номер (ГРСИ)</label>
                        <div class="reg-numbers-container" id="regNumbersContainer"><div class="reg-number-full-item"><div class="reg-number-fields"><input type="text" class="form-input reg-number-input" placeholder="Рег. номер"><input type="url" class="form-input" onfocus="this.select()" placeholder="https://fgis.gost.ru/fundmetrology/..."></div><button type="button" class="remove-reg-number" style="visibility: hidden;">&times;</button></div></div>
                        <button type="button" class="add-reg-number" id="addRegNumber" style="display: none;"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>Добавить</button>
                    </div>
                    <div class="form-row"><div class="form-group"><label class="form-label">Заводской номер *</label><input type="text" class="form-input" id="addSerialNumber"></div><div class="form-group"><label class="form-label">Инвентарный номер *</label><input type="text" class="form-input" id="addInventoryNumber"></div><div class="form-group"><label class="form-label">Год выпуска *</label><input type="text" class="form-input" id="addYearManufactured" placeholder="ГГГГ"></div></div></div>
                    <div class="form-section">
                        <div class="form-section-title">Информация о поверке</div>
                        <div class="form-group"><label class="form-label">Ввод в эксплуатацию *</label><div class="calendar-wrapper"><input type="text" class="form-input datepicker-input" id="addCommissionDate"><span class="calendar-icon"><i class="fas fa-calendar-alt"></i></span><div class="date-error">Некорректная дата</div></div></div>
                        <div class="date-fields-row"><div class="form-group"><label class="form-label">Дата поверки *</label><div class="calendar-wrapper"><input type="text" class="form-input datepicker-input" id="addLastVerificationDate"><span class="calendar-icon"><i class="fas fa-calendar-alt"></i></span><div class="date-error">Некорректная дата</div></div></div><div class="form-group"><label class="form-label">Дата след.поверки *</label><div class="calendar-wrapper"><input type="text" class="form-input datepicker-input" id="addNextVerificationDate"><span class="calendar-icon"><i class="fas fa-calendar-alt"></i></span><div class="date-error">Некорректная дата</div></div></div></div>
                    </div>
                    <div class="form-section"><div class="form-section-title">Дополнительная информация</div><div class="form-row"><div class="form-group"><label class="form-label">Город *</label><input type="text" class="form-input" id="addCity"></div><div class="form-group"><label class="form-label">Ответственный *</label><input type="text" class="form-input" id="addResponsible"></div></div><div class="form-group"><label class="form-label">Примечание</label><textarea class="form-textarea" id="addNotes"></textarea></div></div>
                    <div class="form-section">
                        <div class="form-section-title">Прикрепленные файлы</div>
                        <div class="file-upload-row">
                            <div class="file-upload-group"><label class="file-upload-label"><i class="fas fa-file-pdf"></i> Свидетельство о поверке</label><div class="file-upload-container"><button type="button" class="btn-file-upload" data-target="addCertificate"><i class="fas fa-paperclip"></i></button><input type="file" class="file-input" id="addCertificate" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"><div class="file-name" id="addCertificateName">Файл не выбран<button type="button" class="btn-remove-file" style="display: none;">&times;</button></div></div></div>
                            <div class="file-upload-group"><label class="file-upload-label"><i class="fas fa-file-invoice"></i> Счет-фактура</label><div class="file-upload-container"><button type="button" class="btn-file-upload" data-target="addInvoice"><i class="fas fa-paperclip"></i></button><input type="file" class="file-input" id="addInvoice" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"><div class="file-name" id="addInvoiceName">Файл не выбран<button type="button" class="btn-remove-file" style="display: none;">&times;</button></div></div></div>
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title">Местоположение оборудования</div>
                        <div class="location-selection">
                            <div class="location-option office active" data-location="office"><i class="fas fa-building location-icon"></i><div class="location-name">В офисе</div><div class="location-description">Оборудование находится в офисе</div></div>
                            <div class="location-option verification" data-location="verification"><i class="fas fa-tachometer-alt location-icon"></i><div class="location-name">На поверке</div><div class="location-description">Оборудование отправлено на поверку</div></div>
                            <div class="location-option business-trip" data-location="business-trip"><i class="fas fa-suitcase location-icon"></i><div class="location-name">В командировке</div><div class="location-description">Используется в командировке</div></div>
                        </div>
                    </div>
                </div>

                <div id="add-vo-fields" style="display: none;">
                    <div class="form-section"><div class="form-section-title">Основная информация</div><div class="form-group"><label class="form-label">Наименование *</label><input type="text" class="form-input" id="addVoName"></div><div class="form-row"><div class="form-group"><label class="form-label">Заводской номер *</label><input type="text" class="form-input" id="addVoSerialNumber"></div><div class="form-group"><label class="form-label">Инвентарный номер *</label><input type="text" class="form-input" id="addVoInventoryNumber"></div></div><div class="form-row"><div class="form-group"><label class="form-label">Год выпуска *</label><input type="text" class="form-input" id="addVoYearManufactured" placeholder="ГГГГ"></div><div class="form-group"><label class="form-label">Город *</label><input type="text" class="form-input" id="addVoCity"></div></div></div>
                    <div class="form-section">
                        <div class="form-section-title">Информация об аттестации</div>
                        <div class="date-fields-row"><div class="form-group"><label class="form-label">Дата аттестации *</label><div class="calendar-wrapper"><input type="text" class="form-input datepicker-input" id="addVoLastVerificationDate"><span class="calendar-icon"><i class="fas fa-calendar-alt"></i></span><div class="date-error">Некорректная дата</div></div></div><div class="form-group"><label class="form-label">Дата след.аттестации *</label><div class="calendar-wrapper"><input type="text" class="form-input datepicker-input" id="addVoNextVerificationDate"><span class="calendar-icon"><i class="fas fa-calendar-alt"></i></span><div class="date-error">Некорректная дата</div></div></div></div>
                    </div>
                    <div class="form-section"><div class="form-group"><label class="form-label">Примечание</label><textarea class="form-textarea" id="addVoNotes"></textarea></div></div>
                    <div class="form-section">
                        <div class="form-section-title">Прикрепленные файлы</div>
                        <div class="file-upload-row">
                            <div class="file-upload-group"><label class="file-upload-label"><i class="fas fa-file-pdf"></i> Свидетельство/Сертификат</label><div class="file-upload-container"><button type="button" class="btn-file-upload" data-target="addVoCertificate"><i class="fas fa-paperclip"></i></button><input type="file" class="file-input" id="addVoCertificate" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"><div class="file-name" id="addVoCertificateName">Файл не выбран<button type="button" class="btn-remove-file" style="display: none;">&times;</button></div></div></div>
                            <div class="file-upload-group"><label class="file-upload-label"><i class="fas fa-file-invoice"></i> Счет-фактура</label><div class="file-upload-container"><button type="button" class="btn-file-upload" data-target="addVoInvoice"><i class="fas fa-paperclip"></i></button><input type="file" class="file-input" id="addVoInvoice" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"><div class="file-name" id="addVoInvoiceName">Файл не выбран<button type="button" class="btn-remove-file" style="display: none;">&times;</button></div></div></div>
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title">Местоположение оборудования</div>
                        <div class="location-selection">
                            <div class="location-option office active" data-location="office"><i class="fas fa-building location-icon"></i><div class="location-name">В офисе</div><div class="location-description">Оборудование находится в офисе</div></div>
                            <div class="location-option verification" data-location="verification"><i class="fas fa-tachometer-alt location-icon"></i><div class="location-name">На поверке</div><div class="location-description">Оборудование отправлено на поверку</div></div>
                            <div class="location-option business-trip" data-location="business-trip"><i class="fas fa-suitcase location-icon"></i><div class="location-name">В командировке</div><div class="location-description">Используется в командировке</div></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer"><div class="error-message" id="errorMessage"></div><div class="modal-footer-buttons"><button class="btn btn-primary" id="saveBtn">Сохранить</button></div></div>
        </div>
    </div>
    
    <!-- Модальное окно для редактирования -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Редактирование оборудования</div>
                <button class="modal-close" type="button">
                    <svg width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                        <line x1="1" y1="1" x2="13" y2="13"></line>
                        <line x1="13" y1="1" x2="1" y2="13"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body"><!-- Динамическое содержимое --></div>
            <div class="modal-footer"><div class="error-message" id="editErrorMessage"></div><div class="modal-footer-buttons"><button class="btn btn-primary" id="saveEdit">Сохранить</button></div></div>
        </div>
    </div>
    
    <!-- Общее модальное окно подтверждения -->
    <div id="confirmModal" class="modal-overlay">
        <div class="modal-box confirm-dialog" role="dialog" aria-modal="true" aria-labelledby="confirmModalTitle">
            <h2 id="confirmModalTitle" class="confirm-title">Подтверждение</h2>
            <p id="confirmModalText" class="confirm-text">Вы уверены?</p>
            <div id="confirmModalInputWrapper" class="hidden">
                <input type="text" id="confirmModalInput" class="form-input">
            </div>
            <div class="modal-actions">
                <button type="button" id="confirmModalCancelBtn" class="btn btn-cancel">Отмена</button>
                <button type="button" id="confirmModalOkBtn" class="btn btn-confirm">Да</button>
            </div>
        </div>
    </div>
    
    <div class="notification-container" id="notification-container"></div>

    <!-- Подключаем скрипты -->
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="/js/utils/global-toaster.js"></script>
    <script type="module" src="/js/common/modals.js"></script>
    <script type="module" src="/js/components/datepicker.js"></script>
    <script type="module" src="/js/common/api-client.js"></script>
    
    <!-- Финальное подключение новой точки входа JavaScript -->
    <script type="module" src="/js/verification/main.js"></script>
</body>
</html>